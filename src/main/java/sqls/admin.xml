<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Admin">
	<select id="adminWeekStatus" parameterType="String"
		resultType="com.needle.FsoFso.admin.dto.DailyDetailDto">
		select a.created_at as date, sum(b.total_price) as sales, count(b.id) as salesCnt, a.memcnt as signinCnt 
		from (select count(substring(mem.created_at, 1, 10)) as memcnt, substring(mem.created_at, 1, 10) as d, mem.created_at as created_at
					from members as mem
					where substring(mem.created_at, 1, 10) = #{day}) as a, orders b
		where substring(b.ordered_at, 1, 10) = a.d;
	</select>

	<select id="adminMemberList"
		resultType="com.needle.FsoFso.admin.dto.AdminMemberDto">
		select a.nickname as nickname, a.id as id, a.age_range as ageRange, a.gender as gender, count(*) as purchasesCount,
				sum(b.total_price) as totalPurchase, a.created_at as createdAt, a.updated_at as updatedAt
		from members a, orders b
		where a.id = b.member_id
		group by a.id
		order by sum(b.total_price) desc;
	</select>

	<select id="adminProductList"
		resultType="com.needle.FsoFso.admin.dto.AdminProductDto">
		select a.id as productId, a.thumbnail_url as imgUrl,
				a.name as productName, a.stock as stock, sum(b.quantity) as salesCount, 
				a.created_at as createdAt, a.updated_at as updatedAt
		from products a, order_product b
		where a.id = b.product_id
		group by a.id;
	</select>

</mapper>