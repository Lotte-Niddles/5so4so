<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Admin">
	<select id="adminMain"
		resultType="com.needle.FsoFso.admin.dto.DailyDetailDto">
		select a.created_at as date, sum(b.total_price) as sales, 
				 count(a.id) as salesCnt, count(b.id) as signinCnt
		from members a, orders b
		where substring(a.created_at, 1, 10) = substring(b.ordered_at, 1, 10)
				and DATE_COLUMN BETWEEN DATE_ADD(NOW(),INTERVAL -1 WEEK ) AND NOW()
		group by substring(a.created_at, 1, 10);
	</select>

	<select id="adminMemberList"
		resultType="com.needle.FsoFso.admin.dto.AdminMemberDto">
		select a.nickname, a.id, a.age_range, count(*),
				sum(b.total_price), a.created_at
		from members a, orders b
		where a.id = b.member_id
		group by a.id
		order by sum(b.total_price);
	</select>

	<select id="adminProductList"
		resultType="com.needle.FsoFso.admin.dto.AdminProductDto">
		select a.id as productId, a.thumbnail_url as imgUrl,
				a.productName as productName, a.stock as stock, sum(b.quantity) as salesCount, 
				a.created_at as createdAt, a.updated_at as updatedAt
		from products a, order_product b
		where a.id = b.product_id
		group by a.id;
	</select>

</mapper>